{% extends "base.html" %}

{% block head %}
{{ super() }}
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<style>
    /* üé® Glassmorphism Form Container - Same as Home Page */
    .form-container {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 24px;
        padding: 20px 25px;
        margin: 20px auto;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1),
                    0 4px 16px rgba(0, 0, 0, 0.05);
        max-width: 1100px;
        position: relative;
        z-index: 1;
    }
    
    /* Dark mode form container */
    [data-theme="dark"] .form-container {
        background: rgba(15, 23, 42, 0.6);
        border-color: rgba(71, 85, 105, 0.3);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3),
                    0 4px 16px rgba(0, 0, 0, 0.2);
    }
    
    /* Enhanced glassmorphism form inputs */
    .form-group input,
    .form-control,
    input[type="text"],
    button[type="submit"] {
        height: 48px !important;
        padding: 12px 16px !important;
        border: 2px solid rgba(255, 255, 255, 0.7) !important;
        border-radius: 12px !important;
        font-size: 16px !important;
        background: rgba(255, 255, 255, 0.95) !important;
        backdrop-filter: blur(10px) !important;
        -webkit-backdrop-filter: blur(10px) !important;
        color: #1f2937 !important;
        font-weight: 500 !important;
        transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94) !important;
        box-sizing: border-box !important;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15) !important;
    }
    
    /* Button specific styling */
    button[type="submit"],
    .btn-primary {
        background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%) !important;
        border-color: #3b82f6 !important;
        color: white !important;
        cursor: pointer !important;
        text-align: center !important;
        white-space: nowrap !important;
    }
    
    button[type="submit"]:hover,
    .btn-primary:hover {
        background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%) !important;
        transform: translateY(-1px) !important;
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4) !important;
    }
    
    .btn-secondary {
        background: rgba(107, 114, 128, 0.9) !important;
        border-color: rgba(107, 114, 128, 0.7) !important;
        color: white !important;
    }
    
    .btn-secondary:hover {
        background: rgba(75, 85, 99, 1) !important;
        transform: translateY(-1px) !important;
    }
    
         input[type="text"]:focus {
         border-color: #3b82f6 !important;
         background: rgba(255, 255, 255, 0.98) !important;
         color: #1f2937 !important;
         box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.2), 0 4px 12px rgba(0, 0, 0, 0.15) !important;
         transform: translateY(-1px) !important;
         outline: none !important;
     }
     
     /* Smooth transition for double-click animation */
     input[type="text"] {
         transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94), transform 0.15s ease !important;
     }
    
    input[type="text"]::placeholder {
        color: rgba(31, 41, 59, 0.6) !important;
        font-weight: 400 !important;
    }
    
    /* Enhanced labels */
    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        font-size: 0.9rem;
        color: #ffffff !important;
        background: rgba(30, 41, 59, 0.8) !important;
        backdrop-filter: blur(10px) !important;
        -webkit-backdrop-filter: blur(10px) !important;
        padding: 6px 12px !important;
        border-radius: 8px !important;
        border: 1px solid rgba(255, 255, 255, 0.2) !important;
        width: fit-content !important;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2) !important;
        letter-spacing: 0.025em !important;
    }
    
    /* Dark mode input overrides */
    [data-theme="dark"] .form-group input,
    [data-theme="dark"] .form-control,
    [data-theme="dark"] input[type="text"] {
        background: rgba(30, 41, 59, 0.95) !important;
        border-color: rgba(148, 163, 184, 0.8) !important;
        color: #f1f5f9 !important;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4) !important;
    }
    
    [data-theme="dark"] input[type="text"]:focus {
        background: rgba(30, 41, 59, 0.98) !important;
        border-color: rgba(148, 163, 184, 1) !important;
        color: #f1f5f9 !important;
        box-shadow: 0 0 0 4px rgba(148, 163, 184, 0.3), 0 2px 12px rgba(0, 0, 0, 0.5) !important;
    }
    
    [data-theme="dark"] input[type="text"]::placeholder {
        color: rgba(241, 245, 249, 0.7) !important;
    }
    
    [data-theme="dark"] .form-group label {
        color: #f1f5f9 !important;
        background: rgba(71, 85, 105, 0.8) !important;
        border-color: rgba(148, 163, 184, 0.3) !important;
    }
    
    /* üé® Article Cards with Glassmorphism */
    .article-card {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 16px;
        padding: 24px;
        margin-bottom: 24px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }
    
    .article-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 48px rgba(0, 0, 0, 0.15);
        border-color: rgba(255, 255, 255, 0.3);
    }
    
    [data-theme="dark"] .article-card {
        background: rgba(15, 23, 42, 0.6);
        border-color: rgba(71, 85, 105, 0.3);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }
    
    [data-theme="dark"] .article-card:hover {
        border-color: rgba(71, 85, 105, 0.5);
        box-shadow: 0 12px 48px rgba(0, 0, 0, 0.4);
    }
    
    /* Article Content Areas */
    .article-main, .article-insights {
        background: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 16px;
    }
    
    [data-theme="dark"] .article-main,
    [data-theme="dark"] .article-insights {
        background: rgba(30, 41, 59, 0.8);
        border-color: rgba(71, 85, 105, 0.3);
    }
    
    /* Enhanced Typography */
    .article-title {
        color: #1f2937;
        font-size: 1.25rem;
        font-weight: 600;
        margin-bottom: 12px;
        text-decoration: none;
        transition: all 0.2s ease;
    }
    
    .article-title:hover {
        color: #3b82f6;
        text-decoration: none;
    }
    
    [data-theme="dark"] .article-title {
        color: #f1f5f9;
    }
    
    [data-theme="dark"] .article-title:hover {
        color: #60a5fa;
    }
    
    .article-meta {
        color: #6b7280;
        font-size: 0.875rem;
        margin-bottom: 16px;
    }
    
    [data-theme="dark"] .article-meta {
        color: #9ca3af;
    }
    
    /* Content badges */
    .content-badge {
        display: inline-block;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
        margin-bottom: 12px;
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .badge-summary {
        background: rgba(14, 165, 233, 0.2);
        color: #0369a1;
        border-color: rgba(14, 165, 233, 0.3);
    }
    
    .badge-insights {
        background: rgba(168, 85, 247, 0.2);
        color: #7e22ce;
        border-color: rgba(168, 85, 247, 0.3);
    }
    
    [data-theme="dark"] .badge-summary {
        background: rgba(14, 165, 233, 0.3);
        color: #7dd3fc;
    }
    
    [data-theme="dark"] .badge-insights {
        background: rgba(168, 85, 247, 0.3);
        color: #c084fc;
    }
    
    /* Pagination with glassmorphism */
    .pagination-container {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 16px;
        padding: 16px;
        margin: 24px 0;
    }
    
    [data-theme="dark"] .pagination-container {
        background: rgba(15, 23, 42, 0.6);
        border-color: rgba(71, 85, 105, 0.3);
    }
    
    .pagination-btn {
        background: rgba(255, 255, 255, 0.8) !important;
        backdrop-filter: blur(8px) !important;
        border: 1px solid rgba(255, 255, 255, 0.3) !important;
        border-radius: 8px !important;
        padding: 8px 12px !important;
        color: #1f2937 !important;
        text-decoration: none !important;
        transition: all 0.2s ease !important;
        font-weight: 500 !important;
        min-width: 44px !important;
        text-align: center !important;
        display: inline-block !important;
    }
    
    .pagination-btn:hover {
        background: rgba(59, 130, 246, 0.8) !important;
        color: white !important;
        transform: translateY(-1px) !important;
    }
    
    .pagination-btn.active {
        background: rgba(59, 130, 246, 0.9) !important;
        color: white !important;
    }
    
    [data-theme="dark"] .pagination-btn {
        background: rgba(30, 41, 59, 0.8) !important;
        border-color: rgba(71, 85, 105, 0.3) !important;
        color: #f1f5f9 !important;
    }
    
    [data-theme="dark"] .pagination-btn:hover {
        background: rgba(59, 130, 246, 0.8) !important;
        color: white !important;
    }
    
    /* Search examples styling */
    .search-examples {
        background: rgba(255, 255, 255, 0.6);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 8px;
        padding: 12px;
        font-size: 0.75rem;
        color: #4b5563;
        margin-top: 8px;
    }
    
    [data-theme="dark"] .search-examples {
        background: rgba(30, 41, 59, 0.6);
        border-color: rgba(71, 85, 105, 0.3);
        color: #9ca3af;
    }
    
    /* Results count styling */
    .results-count {
        background: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 12px;
        padding: 12px 16px;
        margin-bottom: 20px;
        font-size: 1rem;
        color: #374151;
        font-weight: 500;
    }
    
    [data-theme="dark"] .results-count {
        background: rgba(30, 41, 59, 0.8);
        border-color: rgba(71, 85, 105, 0.3);
        color: #d1d5db;
    }
    
    /* Markdown content styling */
    .markdown-content {
        line-height: 1.6;
    }
    
    .markdown-content ul {
        list-style: disc !important;
        padding-left: 1.5rem !important;
        margin-bottom: 1rem !important;
    }
    
    .markdown-content li {
        display: list-item !important;
        margin-bottom: 0.5rem !important;
        color: inherit;
    }
    
    .markdown-content h2, .markdown-content h3, .markdown-content h4 {
        font-weight: 600;
        margin-top: 1rem;
        margin-bottom: 0.5rem;
        color: inherit;
    }
    
    [data-theme="dark"] .markdown-content {
        color: #e5e7eb;
    }
    
    /* Article layout responsiveness */
    .article-layout {
        display: grid;
        gap: 1.5rem;
        margin: 1rem 0;
    }
    
    @media (min-width: 1024px) {
        .article-layout {
            grid-template-columns: 3fr 2fr;
        }
    }
    
    /* Mobile optimizations */
    @media (max-width: 768px) {
        .form-container {
            margin: 1rem;
            padding: 1rem;
        }
        
        .article-card {
            margin: 1rem;
            padding: 16px;
        }
        
        .pagination-container {
            margin: 1rem;
        }
    }
    
    /* Sentiment badges */
    .sentiment-badge {
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 600;
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .sentiment-positive {
        background: rgba(34, 197, 94, 0.2);
        color: #15803d;
        border-color: rgba(34, 197, 94, 0.3);
    }
    
    .sentiment-negative {
        background: rgba(239, 68, 68, 0.2);
        color: #dc2626;
        border-color: rgba(239, 68, 68, 0.3);
    }
    
    .sentiment-neutral {
        background: rgba(251, 191, 36, 0.2);
        color: #d97706;
        border-color: rgba(251, 191, 36, 0.3);
    }
    
    [data-theme="dark"] .sentiment-positive {
        background: rgba(34, 197, 94, 0.3);
        color: #4ade80;
    }
    
    [data-theme="dark"] .sentiment-negative {
        background: rgba(239, 68, 68, 0.3);
        color: #f87171;
    }
    
    [data-theme="dark"] .sentiment-neutral {
        background: rgba(251, 191, 36, 0.3);
        color: #fbbf24;
    }
    
    /* ü§ñ AI Search Suggestions Styling */
    .ai-suggestions-container {
        background: linear-gradient(135deg, rgba(139, 92, 246, 0.08) 0%, rgba(59, 130, 246, 0.05) 100%);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid rgba(139, 92, 246, 0.2);
        border-radius: 20px;
        padding: 20px;
        margin: 20px 0;
        box-shadow: 0 8px 32px rgba(139, 92, 246, 0.1);
        position: relative;
        overflow: hidden;
    }
    
    [data-theme="dark"] .ai-suggestions-container {
        background: linear-gradient(135deg, rgba(139, 92, 246, 0.15) 0%, rgba(59, 130, 246, 0.10) 100%);
        border-color: rgba(139, 92, 246, 0.3);
        box-shadow: 0 8px 32px rgba(139, 92, 246, 0.2);
    }
    
    .ai-suggestions-header h3 {
        margin: 0 0 8px 0;
        font-size: 18px;
        font-weight: 600;
        color: #7c3aed;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    [data-theme="dark"] .ai-suggestions-header h3 {
        color: #a78bfa;
    }
    
    .ai-suggestions-header p {
        margin: 0 0 16px 0;
        color: #6b7280;
        font-size: 14px;
    }
    
    [data-theme="dark"] .ai-suggestions-header p {
        color: #9ca3af;
    }
    
    .suggestions-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 12px;
        margin-bottom: 16px;
    }
    
    @media (max-width: 768px) {
        .suggestions-grid {
            grid-template-columns: 1fr;
            gap: 10px;
        }
        
        .ai-suggestions-container {
            margin: 16px 0;
            padding: 16px;
        }
        
        .suggestion-btn {
            padding: 10px 14px;
        }
    }
    
    .suggestion-btn {
        background: rgba(255, 255, 255, 0.7);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        border: 1px solid rgba(139, 92, 246, 0.2);
        border-radius: 12px;
        padding: 12px 16px;
        text-align: left;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        position: relative;
        overflow: hidden;
        box-shadow: 0 4px 16px rgba(139, 92, 246, 0.1);
    }
    
    [data-theme="dark"] .suggestion-btn {
        background: rgba(30, 41, 59, 0.8);
        border-color: rgba(139, 92, 246, 0.3);
        box-shadow: 0 4px 16px rgba(139, 92, 246, 0.15);
    }
    
    .suggestion-btn:hover {
        transform: translateY(-2px);
        background: rgba(255, 255, 255, 0.9);
        border-color: rgba(139, 92, 246, 0.4);
        box-shadow: 0 8px 32px rgba(139, 92, 246, 0.2);
    }
    
    [data-theme="dark"] .suggestion-btn:hover {
        background: rgba(30, 41, 59, 0.95);
        border-color: rgba(139, 92, 246, 0.5);
    }
    
    .suggestion-btn:active {
        transform: translateY(0);
        background: rgba(139, 92, 246, 0.1);
    }
    
    .suggestion-term {
        display: block;
        font-weight: 600;
        font-size: 15px;
        color: #374151;
        margin-bottom: 4px;
    }
    
    [data-theme="dark"] .suggestion-term {
        color: #f3f4f6;
    }
    
    .suggestion-type {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 6px;
        font-size: 11px;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 6px;
    }
    
    .suggestion-type-symbol {
        background: rgba(34, 197, 94, 0.15);
        color: #16a34a;
        border: 1px solid rgba(34, 197, 94, 0.2);
    }
    
    .suggestion-type-related {
        background: rgba(59, 130, 246, 0.15);
        color: #2563eb;
        border: 1px solid rgba(59, 130, 246, 0.2);
    }
    
    .suggestion-type-broader {
        background: rgba(245, 158, 11, 0.15);
        color: #d97706;
        border: 1px solid rgba(245, 158, 11, 0.2);
    }
    
    .suggestion-type-industry {
        background: rgba(168, 85, 247, 0.15);
        color: #9333ea;
        border: 1px solid rgba(168, 85, 247, 0.2);
    }
    
    .suggestion-type-synonym {
        background: rgba(236, 72, 153, 0.15);
        color: #db2777;
        border: 1px solid rgba(236, 72, 153, 0.2);
    }
    
    .suggestion-type-specific {
        background: rgba(20, 184, 166, 0.15);
        color: #0d9488;
        border: 1px solid rgba(20, 184, 166, 0.2);
    }
    
    .suggestion-reason {
        display: block;
        font-size: 12px;
        color: #6b7280;
        font-style: italic;
    }
    
    [data-theme="dark"] .suggestion-reason {
        color: #9ca3af;
    }
    
    .ai-suggestions-footer {
        text-align: center;
        margin-top: 12px;
        padding-top: 12px;
        border-top: 1px solid rgba(139, 92, 246, 0.2);
    }
    
    .ai-suggestions-footer small {
        color: #8b5cf6;
        font-size: 11px;
    }
    
    [data-theme="dark"] .ai-suggestions-footer small {
        color: #a78bfa;
    }
    
    /* üîß Related Symbols Styling Fix - Better contrast for light mode */
    .symbol-tag {
        background: rgba(59, 130, 246, 0.9) !important;
        color: white !important;
        border: 1px solid rgba(59, 130, 246, 0.7) !important;
        padding: 4px 10px !important;
        border-radius: 6px !important;
        font-size: 0.875rem !important;
        font-weight: 500 !important;
        text-decoration: none !important;
        transition: all 0.2s ease !important;
        display: inline-block !important;
        margin-right: 6px !important;
        margin-bottom: 4px !important;
    }
    
    .symbol-tag:hover {
        background: rgba(37, 99, 235, 1) !important;
        color: white !important;
        text-decoration: none !important;
        transform: translateY(-1px) !important;
        box-shadow: 0 4px 8px rgba(59, 130, 246, 0.3) !important;
    }
    
    /* Dark mode symbol tags */
    [data-theme="dark"] .symbol-tag {
        background: rgba(30, 41, 59, 0.9) !important;
        color: #f1f5f9 !important;
        border-color: rgba(71, 85, 105, 0.7) !important;
    }
    
    [data-theme="dark"] .symbol-tag:hover {
        background: rgba(51, 65, 85, 1) !important;
        color: #f1f5f9 !important;
        border-color: rgba(71, 85, 105, 1) !important;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mx-auto p-4">
    <!-- Search Form with Glassmorphism -->
    <div class="form-container">
        <div class="mb-4">
            <h1 class="text-2xl font-bold mb-4" style="color: #ffffff; text-shadow: 0 2px 4px rgba(0,0,0,0.3);">News Search</h1>
            
            <form id="searchForm" method="GET" action="{{ url_for('news.search') }}">
                <div class="form-group">
                    <label for="q">Enter Stock Symbol or Keywords:</label>
                                         <div class="flex space-x-4">
                         <input type="text" 
                                id="q" 
                                name="q" 
                                value="{{ search_params.q or search_params.symbol or search_params.keywords }}"
                                class="form-control flex-grow"
                                placeholder="AAPL or artificial intelligence or AAPL earnings"
                                title="Double-click to clear search">
                         <button type="submit" class="btn-primary">
                             Search
                         </button>
                     </div>
                </div>
                
                                 <!-- Search examples helper -->
                 <div class="search-examples">
                     <strong>Search Examples:</strong> 
                     <span class="font-mono">AAPL</span> (symbols), 
                     <span class="font-mono">artificial intelligence</span> (keywords), 
                     <span class="font-mono">china latest</span> (region), 
                     <span class="font-mono">highest sentiment</span> (sort), 
                     <span class="font-mono">lowest china</span> (sort + region)
                     <br><strong>üí° Tip:</strong> Double-click search box to clear
                 </div>
            </form>
        </div>
    </div>

    <!-- Results Count -->
    <div class="results-count">
        {% if error %}
            <div class="text-red-500">Error: {{ error }}</div>
        {% elif articles %}
            {% if pagination and pagination.total > 0 %}
                Article {{ pagination.page }} of {{ pagination.total }}
                {% if region_info %}
                    <span class="text-blue-600 font-medium">üåç {{ region_info }}</span>
                {% endif %}
                {% if search_params.get('sort_order') == 'HIGHEST' %}
                    <span class="text-red-500 font-medium">üîù Highest Sentiment</span>
                {% elif search_params.get('sort_order') == 'LOWEST' %}
                    <span class="text-orange-500 font-medium">üîª Lowest Sentiment</span>
                {% endif %}
                {% if search_params.get('has_latest') %}
                    <span class="text-purple-600 font-medium">üïê Last 3 Days</span>
                {% endif %}
            {% else %}
                No articles found for "{{ search_params.q or search_params.symbol or search_params.keywords }}"
                {% if region_info %}
                    <span class="text-blue-600 font-medium">üåç {{ region_info }}</span>
                {% endif %}
                {% if search_params.get('sort_order') == 'HIGHEST' %}
                    <span class="text-red-500 font-medium">üîù Highest Sentiment</span>
                {% elif search_params.get('sort_order') == 'LOWEST' %}
                    <span class="text-orange-500 font-medium">üîª Lowest Sentiment</span>
                {% endif %}
                {% if search_params.get('has_latest') %}
                    <span class="text-purple-600 font-medium">üïê Last 3 Days</span>
                {% endif %}
                {% if session.get('last_search_variants') %}
                <div class="text-sm opacity-75 mt-1">
                    (Searched for variants: {{ session.get('last_search_variants')|join(", ") }})
                </div>
                {% endif %}
            {% endif %}
        {% elif search_params.q or search_params.symbol or search_params.keywords %}
            No articles found for "{{ search_params.q or search_params.symbol or search_params.keywords }}"
            {% if region_info %}
                <span class="text-blue-600 font-medium">üåç {{ region_info }}</span>
            {% endif %}
            {% if search_params.get('sort_order') == 'HIGHEST' %}
                <span class="text-red-500 font-medium">üîù Highest Sentiment</span>
            {% elif search_params.get('sort_order') == 'LOWEST' %}
                <span class="text-orange-500 font-medium">üîª Lowest Sentiment</span>
            {% endif %}
            {% if search_params.get('has_latest') %}
                <span class="text-purple-600 font-medium">üïê Last 3 Days</span>
            {% endif %}
            {% if session.get('last_search_variants') %}
            <div class="text-sm opacity-75 mt-1">
                (Searched for variants: {{ session.get('last_search_variants')|join(", ") }})
            </div>
            {% endif %}
        {% endif %}
    </div>
    
    <!-- AI-Powered Search Suggestions -->
    {% if ai_suggestions and not articles %}
    <div class="ai-suggestions-container">
        <div class="ai-suggestions-header">
            <h3>ü§ñ AI Search Suggestions</h3>
            <p>Try these related terms that might have more results:</p>
        </div>
        <div class="suggestions-grid">
            {% for suggestion in ai_suggestions %}
            <button class="suggestion-btn" onclick="searchWithSuggestion('{{ suggestion.term }}', '{{ suggestion.type }}')">
                <span class="suggestion-term">{{ suggestion.term }}</span>
                <span class="suggestion-type suggestion-type-{{ suggestion.type }}">{{ suggestion.type }}</span>
                <span class="suggestion-reason">{{ suggestion.reason }}</span>
            </button>
            {% endfor %}
        </div>
        <div class="ai-suggestions-footer">
            <small>üí° These suggestions are generated by AI based on your search query</small>
        </div>
    </div>
    {% endif %}
    
    <!-- Top Pagination -->
    {% if articles and pagination and pagination.pages > 1 %}
    <div class="pagination-container">
        <div class="flex justify-between items-center">
            <div class="flex space-x-2">
                {% if pagination.has_prev %}
                <a href="{{ url_for('news.search', page=pagination.prev_num, 
                        q=search_params.q if search_params.q else '',
                        symbol=search_params.symbol if search_params.symbol else '',
                        keywords=search_params.keywords if search_params.keywords else '',
                        sort_order=search_params.get('sort_order'), 
                        region_filter=search_params.get('region_filter'),
                        date_filter=search_params.get('date_filter'),
                        processing_filter=search_params.get('processing_filter'),
                        sentiment_filter=search_params.get('sentiment_filter')) }}"
                   class="pagination-btn">
                    ‚Üê Previous
                </a>
                {% else %}
                <span class="pagination-btn opacity-50 cursor-not-allowed">
                    ‚Üê Previous
                </span>
                {% endif %}
                
                {% if pagination.has_next %}
                <a href="{{ url_for('news.search', page=pagination.next_num, 
                        q=search_params.q if search_params.q else '',
                        symbol=search_params.symbol if search_params.symbol else '',
                        keywords=search_params.keywords if search_params.keywords else '',
                        sort_order=search_params.get('sort_order'), 
                        region_filter=search_params.get('region_filter'),
                        date_filter=search_params.get('date_filter'),
                        processing_filter=search_params.get('processing_filter'),
                        sentiment_filter=search_params.get('sentiment_filter')) }}"
                   class="pagination-btn">
                    Next ‚Üí
                </a>
                {% else %}
                <span class="pagination-btn opacity-50 cursor-not-allowed">
                    Next ‚Üí
                </span>
                {% endif %}
            </div>
            
            <div class="text-sm opacity-75">
                Page {{ pagination.page }} of {{ pagination.pages }}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Articles Container -->
    <div id="articlesContainer">
        {% if articles %}
            {% for article in articles %}
            <div class="article-card">
                <!-- Article header -->
                <a href="{{ article.url }}" target="_blank" 
                   class="article-title block mb-3 hover:opacity-80">
                    {{ article.title }}
                </a>
                
                <div class="article-meta">
                    Published: {{ article.published_at if article.published_at else 'Unknown' }}
                    {% if article.symbols %}
                    <div class="mt-1">
                        Related Symbols: 
                        {% for symbol in article.symbols %}
                        <a href="{{ url_for('news.search', symbol=symbol.symbol) }}" 
                           class="symbol-tag">
                            {{ symbol.symbol }}
                        </a>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>

                <!-- Two-column layout -->
                <div class="article-layout">
                    <!-- Left column: Main content -->
                    <div class="article-main">
                        <!-- AI Summary (if available) -->
                        {% if article.summary and article.summary.ai_summary %}
                        <div class="mb-6">
                            <span class="content-badge badge-summary">AI Summary</span>
                            <div class="markdown-content">
                                {{ article.summary.ai_summary|markdown|safe }}
                            </div>
                        </div>
                        {% endif %}

                        <!-- Original Content (if AI summary not available) -->
                        {% if not (article.summary and article.summary.ai_summary) and article.content %}
                        <div class="mb-6">
                            <span class="content-badge" style="background: rgba(252, 211, 77, 0.2); color: #92400e; border-color: rgba(252, 211, 77, 0.3);">Original Content</span>
                            <div class="text-gray-700 leading-relaxed">
                                {{ article.content[:500] }}{% if article.content|length > 500 %}...{% endif %}
                            </div>
                            {% if article.content|length > 500 %}
                            <a href="{{ article.url }}" target="_blank" class="text-blue-500 hover:text-blue-700 text-sm mt-2 inline-block">
                                Read full article ‚Üí
                            </a>
                            {% endif %}
                        </div>
                        {% endif %}

                        <!-- Fallback when no content available -->
                        {% if not (article.summary and article.summary.ai_summary) and not article.content %}
                        <div class="mb-6">
                            <span class="content-badge" style="background: rgba(254, 202, 202, 0.2); color: #991b1b; border-color: rgba(254, 202, 202, 0.3);">No Content Available</span>
                            <div class="text-gray-500 italic">
                                Content not yet fetched. <a href="{{ article.url }}" target="_blank" class="text-blue-500 hover:text-blue-700">View original article ‚Üí</a>
                            </div>
                        </div>
                        {% endif %}

                        <!-- AI Sentiment Rating -->
                        {% if article.summary and article.summary.ai_sentiment_rating is not none %}
                        <div class="text-sm mt-4 pt-4 border-t border-opacity-20">
                            <span class="sentiment-badge {% if article.summary.ai_sentiment_rating > 50 %}sentiment-positive{% elif article.summary.ai_sentiment_rating < -50 %}sentiment-negative{% else %}sentiment-neutral{% endif %}">
                                AI Sentiment Rating: {{ article.summary.ai_sentiment_rating }}
                            </span>
                        </div>
                        {% endif %}
                    </div>

                    <!-- Right column: AI Insights -->
                    <div class="article-insights">
                        {% if article.summary and article.summary.ai_insights %}
                        <span class="content-badge badge-insights">AI Insights</span>
                        <div class="markdown-content">
                            {{ article.summary.ai_insights|markdown|safe }}
                        </div>
                        {% else %}
                        <!-- Show article metadata when AI insights not available -->
                        <span class="content-badge" style="background: rgba(240, 249, 255, 0.2); color: #0369a1; border-color: rgba(240, 249, 255, 0.3);">Article Info</span>
                        <div class="space-y-3 text-sm">
                            <div>
                                <span class="font-medium opacity-75">Source:</span>
                                <span class="opacity-90">{{ article.source or 'Unknown' }}</span>
                            </div>
                            {% if article.author %}
                            <div>
                                <span class="font-medium opacity-75">Author:</span>
                                <span class="opacity-90">{{ article.author }}</span>
                            </div>
                            {% endif %}
                            <div>
                                <span class="font-medium opacity-75">Published:</span>
                                <span class="opacity-90">{{ article.published_at if article.published_at else 'Unknown' }}</span>
                            </div>
                            {% if article.symbols %}
                            <div>
                                <span class="font-medium opacity-75">Related Symbols:</span>
                                <div class="mt-1 flex flex-wrap gap-1">
                                    {% for symbol in article.symbols %}
                                    <a href="{{ url_for('news.search', symbol=symbol.symbol if symbol.symbol else symbol) }}" 
                                       class="symbol-tag">
                                        {{ symbol.symbol if symbol.symbol else symbol }}
                                    </a>
                                    {% endfor %}
                                </div>
                            </div>
                            {% endif %}
                            <div class="pt-2 border-t border-opacity-20">
                                <a href="{{ article.url }}" target="_blank" 
                                   class="text-blue-500 hover:text-blue-700 text-sm font-medium">
                                    Read Full Article ‚Üí
                                </a>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}

            <!-- Bottom Pagination -->
            {% if pagination and pagination.pages > 1 %}
            <div class="pagination-container">
                <div class="flex justify-center space-x-2 flex-wrap">
                    {% if pagination.has_prev %}
                    <a href="{{ url_for('news.search', page=pagination.prev_num, 
                            q=search_params.q if search_params.q else '',
                            symbol=search_params.symbol if search_params.symbol else '',
                            keywords=search_params.keywords if search_params.keywords else '',
                            sort_order=search_params.get('sort_order'),
                            region_filter=search_params.get('region_filter'),
                            date_filter=search_params.get('date_filter'),
                            processing_filter=search_params.get('processing_filter'),
                            sentiment_filter=search_params.get('sentiment_filter')) }}"
                       class="pagination-btn mb-2">Prev</a>
                    {% endif %}

                    {% for page_num in pagination.iter_pages(left_edge=1, left_current=1, right_current=1, right_edge=1) %}
                        {% if page_num %}
                            {% if page_num == pagination.page %}
                            <span class="pagination-btn active mb-2">
                                {{ page_num }}
                            </span>
                            {% else %}
                            <a href="{{ url_for('news.search', page=page_num, 
                                    q=search_params.q if search_params.q else '',
                                    symbol=search_params.symbol if search_params.symbol else '',
                                    keywords=search_params.keywords if search_params.keywords else '',
                                    sort_order=search_params.get('sort_order'),
                                    region_filter=search_params.get('region_filter'),
                                    date_filter=search_params.get('date_filter'),
                                    processing_filter=search_params.get('processing_filter'),
                                    sentiment_filter=search_params.get('sentiment_filter')) }}"
                               class="pagination-btn mb-2">
                                {{ page_num }}
                            </a>
                            {% endif %}
                        {% else %}
                            <span class="pagination-btn opacity-50 mb-2">‚Ä¶</span>
                        {% endif %}
                    {% endfor %}

                    {% if pagination.has_next %}
                    <a href="{{ url_for('news.search', page=pagination.next_num, 
                            q=search_params.q if search_params.q else '',
                            symbol=search_params.symbol if search_params.symbol else '',
                            keywords=search_params.keywords if search_params.keywords else '',
                            sort_order=search_params.get('sort_order'),
                            region_filter=search_params.get('region_filter'),
                            date_filter=search_params.get('date_filter'),
                            processing_filter=search_params.get('processing_filter'),
                            sentiment_filter=search_params.get('sentiment_filter')) }}"
                       class="pagination-btn mb-2">Next</a>
                    {% endif %}
                </div>
            </div>
            {% endif %}
        {% endif %}
    </div>
</div>

<script>
    function getSentimentClass(rating) {
        if (rating > 50) return 'sentiment-positive';
        if (rating < -50) return 'sentiment-negative';
        return 'sentiment-neutral';
    }
    
    // Double-click to clear search input
    document.addEventListener('DOMContentLoaded', function() {
        const searchInput = document.getElementById('q');
        if (searchInput) {
            searchInput.addEventListener('dblclick', function() {
                this.value = '';
                this.focus();
                // Add a subtle animation to indicate the action
                this.style.transform = 'scale(0.98)';
                setTimeout(() => {
                    this.style.transform = 'scale(1)';
                }, 150);
            });
        }
    });
    
    // Handle AI suggestion clicks
    function searchWithSuggestion(term, type) {
        const searchInput = document.getElementById('q');
        const searchForm = document.getElementById('searchForm');
        
        if (searchInput && searchForm) {
            // Set the suggestion term in the search input
            searchInput.value = term;
            
            // Add visual feedback to show the suggestion was selected
            const suggestionBtns = document.querySelectorAll('.suggestion-btn');
            suggestionBtns.forEach(btn => {
                if (btn.querySelector('.suggestion-term').textContent === term) {
                    btn.style.background = 'rgba(139, 92, 246, 0.3)';
                    btn.style.transform = 'scale(0.98)';
                    setTimeout(() => {
                        btn.style.background = '';
                        btn.style.transform = '';
                    }, 200);
                }
            });
            
            // Track the suggestion click for analytics
            trackSuggestionClick(term, type);
            
            // Trigger the search
            setTimeout(() => {
                searchForm.submit();
            }, 100);
        }
    }
    
    // Track suggestion clicks for analytics (optional)
    function trackSuggestionClick(term, type) {
        try {
            // Log to console for debugging
            console.log('AI Suggestion clicked:', { term, type });
            
            // Optional: Send analytics to server (only if endpoint exists)
            const originalQuery = '{{ search_params.q or search_params.symbol or search_params.keywords }}';
            if (originalQuery) {
                fetch('/news/api/suggestions/click', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        suggestion_term: term,
                        suggestion_type: type,
                        original_query: originalQuery,
                        timestamp: new Date().toISOString()
                    })
                }).catch(err => {
                    // Fail silently for analytics
                    console.log('Analytics tracking failed (this is normal):', err);
                });
            }
        } catch (err) {
            // Fail silently for analytics
            console.log('Analytics error:', err);
        }
    }
</script>

<!-- Enhanced Search JavaScript -->
<script src="{{ url_for('static', filename='js/enhanced-search.js') }}"></script>
{% endblock %}